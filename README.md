# sysctl_loader

これは、linuxのsysctl.confと同じ形式のファイルをパースし、検証するためのサンプルプログラムです。

## 使い方
```sh
${このプログラムのパス} ${読み込みたいファイル名}

# スキーマによるバリデーションを行う場合
${このプログラムのパス} ${読み込みたいファイル名} [-v | --validate]

# このリポジトリのディレクトリで実行する場合の例
cargo run -- examples/success1.conf --validate
```

パースエラーやスキーマエラーがなければ、以下のように読み込んだデータがダンプされます。
```
スキーマエラーはありませんでした。読み込んだデータをRust形式で出力します。{
    "key": SysctlValue {
        value: "hello world!",
        ignore_error: false,
    },
    ...
}
```

## スキーマについて
読み込み対象のファイル名に `.schema`を付けた名前のファイルに、以下の文法に従ったスキーマを書くことで、対象がスキーマの形式に一致しているかを検証することができます。

### 文法
{}は0個以上の繰り返しのことです。
```
key := {=や:を含まない任意の文字}
type := string | bool | number;
entry := key, ":", type, EOL;
comment = ("#" | ";") , { character }, EOL;

EOL := 行の終わりのこと（LF, CRLF両対応）;
EOF := ファイルの終わりのこと;

schema = { (entry | comment) }, EOF;
```

本体同様、;（セミコロン）や #（シャープ）を文頭に置くことで、スキーマファイルにもコメントを書くことができます。


## 文法上の仕様
基本的に以下のリンク先の仕様に従っています。
https://man7.org/linux/man-pages/man5/sysctl.conf.5.html

### 注意するべき仕様
- スキーマのstring型は、boolやnumberに与える文字列も受け入れます。つまり、現状TypeScriptのany型と同じです。
- 行の途中からのコメントはサポートしていません。パースエラーにはなりませんが、例えば値のあとに書いた場合は値に含まれてしまいます。
